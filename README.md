# ESP32envir
本项目是对于环境的监测系统，利用物联网通信技术综合实践去学习物联网通信技术、嵌入式系统、计算机网络等技术对多个不同环境进行监测，并及时反馈给用户，用户通过反馈数据及时对环境条件进行调整处理。
本项目采用三个ESP32开发板进行MESH组网，作为终端子节点2个的ESP32开发板连接传感器，作为协调器的ESP32开发板利用集成的WIFI模块连接无线网络，通过数据库端口进行信息的上传。在终端的传感器采集到信息后，会通过MESH将信息传送给协调器，再由协调器通过MYSQL数据库的端口将数据传送到保存至数据库。而后通过SPRING BOOT上集成的mybatis将数据库中的数据传输至SPRING BOOT +VUE制作的网络展示端，进行网页展示，在展示端通过多组件功能，可以对数据进行分析和处理

关键词：（3-5个）ESP32, MESH组网,MYSQL端口上传，SPRING BOOT 

本项目中MESH命名的文件均为ESP32的硬件Arduino的程序，共有母节点、子节点、土壤变送器节点三个版本代码
每个版本均包含MESH连接的API和公匙，以及MYSQL connection的通讯协议代码

SPRING+VUE为上位机的SPRING BOOT +VUE的前后端分离展示页面
集成Mybatis实现对数据库的数据请求以及反馈

硬件设计：

硬件采用的是Arduino框架的ESP32开发板，采用的原因是他集成的有蓝牙和WIFI模块以及各类通信协议栈，本项目中主要采用的有MESH通信协议栈和MySQL Connection协议栈，，他们分别用于终端子节点和母节点之间的通讯以及下位机与上位机数据库之间的通讯。
子节点开放板需要编写对应传感器的程序，采集温湿度信息，并利用MESH组网的函数库，调用MESH进组网连接母节点传输数据。母节点需要对信息进行格式转化处理并连接上传数据库信息。
 
	
传感器采用的有DHT11以及一个485型的土壤传感器

DHT11 是一款湿温度一体化的数字传感器。该传感器包括一个电阻式测湿元件和一个 NTC
测温元件
DHT11 数字湿温度传感器采用单总线数据格式。即，单个数据引脚端口完成输入输出双向传输。其数据包由 5Byte（40Bit）组成。数据分小数部分和整数部分，一次完整的数据传输为40bit，高位先出。
数据格式：
 8bit湿度整数数据+8bit湿度小数数据+8bit温度整数数据+8bit温度小数数据+8bit校验和
8位校验和：
“8bit湿度整数数据+8bit湿度小数数据+8bi温度整数数据+8bit温度小数数据”相加所得结果的末8位。
控制时序主要分为三部分：
1：触发DHT11采集数数据；
2：读取数字0；
3：读取数字1；
执行流程：
MCU发送起始信号 -> DHT11响应信号 -> DHT11通知MCU准备接受信号 -> DHT11发送准备好的数据 -> DHT11结束信号-> DHT11内部重测环境温湿度数据并记录数据等待下一次MCU的起始信号。



 
485型土壤传感器拥有用于存储不同信息的寄存器，使用时需要对目的寄存器地址进行问询数据，需要编写一串十六进制问询帧，从而获取应答帧获得相应数据。
问询帧数据报文格式为

设备地址位（1位）	功能位（1位）	寄存器地址位（2位）	数据长度（2位）	CRC效验码（2位）

这里由于我采集的数据只有土壤的温湿度环境所以只需要访问前两个寄存器
所以我的问询帧数据为
02 03 00 00 00 02 C4 38


运行中可能的问题以及解决方法

1.组网过程中不同传感器的数据与插入数据库的数据要求类型不同。
	解决办法：将ESP32采集到的数据在子节点中将采集到的数据统一转化为UTF8字符集格式的字符信息，再进行信息的传输，母节点中进行数据处理，通过提取对应数据并进行转化，最终得到所需要的MYSQL数据库插入指令。

2.SPRING BOOT 请求跨域。
	解决办法：重写@WebMvcConfigurer，设置允许SPRINGBOOT后端地址下所有请求时间、请求方法的访问，请求时间范围手动设置为24小时。


